"use strict";var starkAPP=angular.module("starkAPP",["ngRoute","ngAnimate","routeStyles","baseService"]).config(["$compileProvider","$routeProvider","$locationProvider",function(e,t,a){t.when("/main/",{templateUrl:"./html/main.html",css:"./build/css/main.css"}).otherwise({redirectTo:"/main/"})}]);angular.module("baseService",[]).factory("BaseService",["$rootScope",function(e){function t(e){function t(e,t){return e.time&&-1==e.time.indexOf(t["时间"].trim())?!1:e.keywords&&-1==t["课程名称"].trim().indexOf(e.keywords.trim())?!1:e.courseID&&-1==t["选课序号"].trim().indexOf(e.courseID.trim())?!1:!0}if(!(e.time.length||e.keywords.length||e.courseID.length||e.category.length))return[];var a=[];if(e.category.length>0)e.category.forEach(function(r){COURSE_DATA[r].forEach(function(r){t(e,r)&&a.push(r)})});else for(var r in COURSE_DATA)COURSE_DATA[r].forEach(function(r){t(e,r)&&a.push(r)});return a}function a(e){var t,a=e.trim();switch(a.split(" ")[0]){case"一":t=1;break;case"二":t=2;break;case"三":t=3;break;case"四":t=4;break;case"五":t=5;break;case"六":t=6}var r=parseInt(a.split(" ")[1].split("-")[1])-parseInt(a.split(" ")[1].split("-")[0])+1,o=parseInt(a.split(" ")[1].split("-")[0]);return{weekday:t-1,length:r,start:o-1}}String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};var r={data:[[],[],[],[],[],[]],init:function(){this.data.forEach(function(e){for(var t=0;13>t;t++)e.push(0)}),void 0!==localStorage.courseModelData&&(this.data=JSON.parse(localStorage.courseModelData))},update:function(t){for(var o=a(t["时间"]),n=o.weekday,s=o.start,i=o.length,l=!1,c=this,u=0;i>u;u++)0!=this.data[n][s+u]&&(l=!0);if(l){for(var h=[],d=[],u=0;i>u;u++)-1==h.indexOf(this.data[n][s+u]["课程名称"])&&0!=this.data[n][s+u]&&(h.push(this.data[n][s+u]["课程名称"]),d.push(this.data[n][s+u]));var f=h.length>1?h.join("》、《"):h[0];confirm("这门课与《"+f+"》冲突，是否替换？")&&(d.forEach(function(e){c.remove(e)}),this.update(t))}else for(var u=0;i>u;u++)r.data[n][s+u]=t;var g=this.data;localStorage.courseModelData=JSON.stringify(g),e.$broadcast("courseModelUpdate",g)},remove:function(t){for(var r=a(t["时间"]),o=r.weekday,n=(r.start,r.length,0);13>n;n++)this.data[o][n]["选课序号"]==t["选课序号"]&&(this.data[o][n]=0);var s=this.data;localStorage.courseModelData=JSON.stringify(s),e.$broadcast("courseModelUpdate",s)}};r.init();var o={search:t,timeParser:a,courseModel:r};return o}]),angular.module("starkAPP").controller("resultController",["$scope","BaseService",function(e,t){}]),angular.module("starkAPP").controller("searchController",["$scope","BaseService","$timeout","$location",function(e,t,a,r){e.$on("showSearch",function(){$(".search").css("z-index","100"),e.searchShow=!0,a(function(){$(".search-bar input").focus()},700)}),e.close=function(){/bg/.test(event.target.className)&&(e.searchShow=!1,a(function(){$(".search").css("z-index","-9999")},700))},e.kwChange=function(){var a={category:[],keywords:e.keywords,courseID:"",time:""},r=t.search(a);console.log(r),e.result=r,r.length>0?e.resultShow=!0:e.resultShow=!1},e.mouseover=function(){e.detail=this.course},e.courseUpdate=function(){t.courseModel.update(this.detail)}}]),angular.module("starkAPP").controller("sidebarController",["$scope","$rootScope","BaseService","$timeout","$location",function(e,t,a,r,o){"/main/"==o.path()&&(e.mainIsActive=!0),e.showSearch=function(){t.$broadcast("showSearch")}}]),angular.module("starkAPP").controller("tableController",["$scope","BaseService","$timeout",function(e,t,a){function r(a){e.tableView=[[],[],[],[],[],[]],e.tableView.forEach(function(e){for(var t=0;13>t;t++)e.push({length:1})});var r=[];a.forEach(function(e){e.forEach(function(e){0!=e&&r.push(e)})}),r.forEach(function(a){var r=t.timeParser(a["时间"]);if(2==r.length&&(e.tableView[r.weekday][r.start]={text1:a["选课序号"],text2:a["课程名称"],length:r.length,No:0,show:!0,style:"",locate:"start"},e.tableView[r.weekday][r.start+1]={text1:a["教室"],text2:a["教师"],length:r.length,No:1,show:!0,locate:"end"}),3==r.length&&(e.tableView[r.weekday][r.start]={text1:a["选课序号"],length:r.length,No:0,show:!0,style:"",locate:"start"},e.tableView[r.weekday][r.start+1]={text1:a["课程名称"],length:r.length,No:1,show:!0,style:"",locate:"body"},e.tableView[r.weekday][r.start+2]={text1:a["教室"],text2:a["教师"],length:r.length,No:2,show:!0,style:"",locate:"end"}),r.length>=4){for(var o=["选课序号","课程名称","教室","教师"],n=Math.floor((r.length-4)/2),s=0;s<r.length;s++)e.tableView[r.weekday][r.start+s]={length:r.length,No:s,show:!0,style:"",locate:"body"},0==s&&(e.tableView[r.weekday][r.start+s].locate="start"),s==r.length-1&&(e.tableView[r.weekday][r.start+s].locate="end");for(var s=0;4>s;s++){e.tableView[r.weekday][r.start+n+s].text1=a[o[s]]}}})}r(t.courseModel.data),e.$on("courseModelUpdate",function(e,t){r(t)}),e.remove=function(e,a){var r=t.courseModel.data[e][a];t.courseModel.remove(r)},e.hover=function(t,a){for(var r="background:rgba(255, 255, 255, 0.7)",o=e.tableView[a][t].No||0,n=e.tableView[a][t].length-o-1||0,s=0;o>=s;s++)e.tableView[a][t-s].style=r;for(var s=0;n>=s;s++)e.tableView[a][t+s].style=r},e.out=function(t,a){for(var r="background:rgba(255, 255, 255, 0.0)",o=e.tableView[a][t].No||0,n=e.tableView[a][t].length-o-1||0,s=0;o>=s;s++)e.tableView[a][t-s].style=r;for(var s=0;n>=s;s++)e.tableView[a][t+s].style=r}}]);