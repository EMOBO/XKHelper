"use strict";var starkAPP=angular.module("starkAPP",["ngRoute","ngAnimate","routeStyles","baseService"]).config(["$compileProvider","$routeProvider","$locationProvider",function(e,t,a){t.when("/main/",{templateUrl:"./html/main.html",css:"./build/css/main.css"}).otherwise({redirectTo:"/main/"})}]);angular.module("baseService",[]).factory("BaseService",["$rootScope",function(e){function t(e){function t(e,t){return e.time&&-1==e.time.indexOf(t["时间"].trim())?!1:e.keywords&&-1==t["课程名称"].trim().indexOf(e.keywords.trim())?!1:e.courseID&&-1==t["选课序号"].trim().indexOf(e.courseID.trim())?!1:!0}var a=[];if(e.category.length>0)e.category.forEach(function(l){COURSE_DATA[l].forEach(function(l){t(e,l)&&a.push(l)})});else for(var l in COURSE_DATA)COURSE_DATA[l].forEach(function(l){t(e,l)&&a.push(l)});return a}function a(e){var t,a=e.trim();switch(a.split(" ")[0]){case"一":t=1;break;case"二":t=2;break;case"三":t=3;break;case"四":t=4;break;case"五":t=5;break;case"六":t=6}var l=parseInt(a.split(" ")[1].split("-")[1])-parseInt(a.split(" ")[1].split("-")[0])+1,i=parseInt(a.split(" ")[1].split("-")[0]);return{weekday:t-1,length:l,start:i-1}}String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};var l={data:[[],[],[],[],[],[]],init:function(){this.data.forEach(function(e){for(var t=0;13>t;t++)e.push(0)}),void 0!==localStorage.courseModelData&&(this.data=JSON.parse(localStorage.courseModelData))},update:function(t){var i=a(t["时间"]),o=i.weekday,r=i.start,s=i.length;if(0===this.data[o][r]&&0===this.data[o][r+1]&&0===this.data[o][r+s-1])for(var b=0;s>b;b++)l.data[o][r+b]=t;else{for(var y=[],b=0;s>b;b++)console.log(this.data[o][r+b]),-1==y.indexOf(this.data[o][r+b]["课程名称"])&&y.push(this.data[o][r+b]["课程名称"]);console.log(y);var w=y.length>1?y.join("、"):y[0];if(confirm("这门课与"+w+"冲突，是否替换？")){for(var b=0;13>b;b++)-1!=y.indexOf(this.data[o][b])&&(this.data[o][b]=0);for(var b=0;s>b;b++)l.data[o][r+b]=t}}var n=this.data;e.$broadcast("courseModelUpdate",n)}};l.init();var i={search:t,timeParser:a,courseModel:l};return i}]),angular.module("starkAPP").controller("resultController",["$scope","BaseService",function(e,t){}]),angular.module("starkAPP").controller("sidebarController",["$scope","BaseService","$timeout","$location",function(e,t,a,l){"/main/"==l.path()&&(e.mainIsActive=!0)}]),angular.module("starkAPP").controller("mainController",["$scope","BaseService","$timeout",function(e,t,a){function l(a){var l=[];a.forEach(function(e){e.forEach(function(e){0!=e&&l.push(e)})}),l.forEach(function(a){var l=t.timeParser(a["时间"]);2==l.length&&(e.tableView[l.weekday][l.start]={text:a["选课序号"]+"\n"+a["课程名称"],type:"double1",show:!0,style:""},e.tableView[l.weekday][l.start+1]={text:a["教室"]+" "+a["教师"],type:"double2",show:!0,style:""}),3==l.length&&(e.tableView[l.weekday][l.start]={text:a["选课序号"],type:"triple1"},e.tableView[l.weekday][l.start+1]={text:a["课程名称"],type:"triple2"},e.tableView[l.weekday][l.start+2]={text:a["教室"]+" "+a["教师"],type:"triple3"}),4==l.length&&(e.tableView[l.weekday][l.start]={text:a["选课序号"],type:"fourfold1"},e.tableView[l.weekday][l.start+1]={text:a["课程名称"],type:"fourfold2"},e.tableView[l.weekday][l.start+2]={text:a["教室"],type:"fourfold3"},e.tableView[l.weekday][l.start+3]={text:a["教师"],type:"fourfold4"})})}e.tableView=[[],[],[],[],[],[]],e.tableView.forEach(function(e){for(var t=0;13>t;t++)e.push({length:1})}),l(t.courseModel.data),e.$on("courseModelUpdate",function(e,t){l(t)}),e.hover=function(t,a){var l="background:rgba(255, 255, 255, 0.7)";return void 0==e.tableView[a][t].type?void(e.tableView[a][t].style=l):"double1"==e.tableView[a][t].type?(e.tableView[a][t].style=l,void(e.tableView[a][t+1].style=l)):"double2"==e.tableView[a][t].type?(e.tableView[a][t].style=l,void(e.tableView[a][t-1].style=l)):"triple1"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t+1].style=l,void(e.tableView[a][t+2].style=l)):"triple2"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t+1].style=l,void(e.tableView[a][t-1].style=l)):"triple3"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t-1].style=l,void(e.tableView[a][t-2].style=l)):"fourfold1"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t+1].style=l,e.tableView[a][t+2].style=l,void(e.tableView[a][t+3].style=l)):"fourfold2"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t+1].style=l,e.tableView[a][t+2].style=l,void(e.tableView[a][t-1].style=l)):"fourfold3"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t+1].style=l,e.tableView[a][t-1].style=l,void(e.tableView[a][t-2].style=l)):"fourfold4"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t-1].style=l,e.tableView[a][t-2].style=l,void(e.tableView[a][t-3].style=l)):void 0},e.out=function(t,a){var l="background:rgba(255, 255, 255, 0)";return void 0==e.tableView[a][t].type?void(e.tableView[a][t].style=l):"double1"==e.tableView[a][t].type?(e.tableView[a][t].style=l,void(e.tableView[a][t+1].style=l)):"double2"==e.tableView[a][t].type?(e.tableView[a][t].style=l,void(e.tableView[a][t-1].style=l)):"triple1"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t+1].style=l,void(e.tableView[a][t+2].style=l)):"triple2"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t+1].style=l,void(e.tableView[a][t-1].style=l)):"triple3"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t-1].style=l,void(e.tableView[a][t-2].style=l)):"fourfold1"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t+1].style=l,e.tableView[a][t+2].style=l,void(e.tableView[a][t+3].style=l)):"fourfold2"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t+1].style=l,e.tableView[a][t+2].style=l,void(e.tableView[a][t-1].style=l)):"fourfold3"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t+1].style=l,e.tableView[a][t-1].style=l,void(e.tableView[a][t-2].style=l)):"fourfold4"==e.tableView[a][t].type?(e.tableView[a][t].style=l,e.tableView[a][t-1].style=l,e.tableView[a][t-2].style=l,void(e.tableView[a][t-3].style=l)):void 0};var i={category:[],keywords:"",courseID:"",time:"一 6-7"},o=t.search(i);a(function(){t.courseModel.update(o[5])},1e3)}]);