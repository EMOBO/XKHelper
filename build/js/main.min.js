"use strict";var starkAPP=angular.module("starkAPP",["ngRoute","ngAnimate","routeStyles","baseService"]).config(["$compileProvider","$routeProvider","$locationProvider",function(e,t,l){t.when("/main/",{templateUrl:"./html/main.html",css:"./build/css/main.css"}).otherwise({redirectTo:"/main/"})}]);angular.module("baseService",[]).factory("BaseService",["$rootScope",function(e){function t(e){function t(e,t){return e.time&&-1==e.time.indexOf(t["时间"].trim())?!1:e.keywords&&-1==t["课程名称"].trim().indexOf(e.keywords.trim())?!1:e.courseID&&-1==t["选课序号"].trim().indexOf(e.courseID.trim())?!1:!0}if(!(e.time.length||e.keywords.length||e.courseID.length||e.category.length))return[];var l=[];if(e.category.length>0)e.category.forEach(function(a){COURSE_DATA[a].forEach(function(a){t(e,a)&&l.push(a)})});else for(var a in COURSE_DATA)COURSE_DATA[a].forEach(function(a){t(e,a)&&l.push(a)});return l}function l(e){var t,l=e.trim();switch(l.split(" ")[0]){case"一":t=1;break;case"二":t=2;break;case"三":t=3;break;case"四":t=4;break;case"五":t=5;break;case"六":t=6}var a=parseInt(l.split(" ")[1].split("-")[1])-parseInt(l.split(" ")[1].split("-")[0])+1,i=parseInt(l.split(" ")[1].split("-")[0]);return{weekday:t-1,length:a,start:i-1}}String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};var a={data:[[],[],[],[],[],[]],init:function(){this.data.forEach(function(e){for(var t=0;13>t;t++)e.push(0)}),void 0!==localStorage.courseModelData&&(console.log(localStorage.courseModelData),this.data=JSON.parse(localStorage.courseModelData))},update:function(t){var i=l(t["时间"]),o=i.weekday,s=i.start,r=i.length;if(0===this.data[o][s]&&0===this.data[o][s+1]&&0===this.data[o][s+r-1])for(var n=0;r>n;n++)a.data[o][s+n]=t;else{for(var w=[],n=0;r>n;n++)console.log(this.data[o][s+n]),-1==w.indexOf(this.data[o][s+n]["课程名称"])&&w.push(this.data[o][s+n]["课程名称"]);console.log(w);var c=w.length>1?w.join("、"):w[0];if(confirm("这门课与"+c+"冲突，是否替换？")){for(var n=0;13>n;n++)-1!=w.indexOf(this.data[o][n])&&(this.data[o][n]=0);for(var n=0;r>n;n++)a.data[o][s+n]=t;console.log(a)}}var y=this.data;localStorage.courseModelData=JSON.stringify(y),e.$broadcast("courseModelUpdate",y)}};a.init();var i={search:t,timeParser:l,courseModel:a};return i}]),angular.module("starkAPP").controller("resultController",["$scope","BaseService",function(e,t){}]),angular.module("starkAPP").controller("searchController",["$scope","BaseService","$timeout","$location",function(e,t,l,a){e.$on("showSearch",function(){$(".search").css("z-index","100"),e.searchShow=!0,l(function(){$(".search-bar input").focus()},700)}),e.close=function(){/bg/.test(event.target.className)&&(e.searchShow=!1,l(function(){$(".search").css("z-index","-9999")},700))},e.kwChange=function(){var l={category:[],keywords:e.keywords,courseID:"",time:""},a=t.search(l);console.log(a),e.result=a,a.length>0?e.resultShow=!0:e.resultShow=!1},e.mouseover=function(){e.detail=this.course},e.courseUpdate=function(){t.courseModel.update(this.detail)}}]),angular.module("starkAPP").controller("sidebarController",["$scope","$rootScope","BaseService","$timeout","$location",function(e,t,l,a,i){"/main/"==i.path()&&(e.mainIsActive=!0),e.showSearch=function(){t.$broadcast("showSearch")}}]),angular.module("starkAPP").controller("tableController",["$scope","BaseService","$timeout",function(e,t,l){function a(l){var a=[];l.forEach(function(e){e.forEach(function(e){0!=e&&a.push(e)})}),a.forEach(function(l){var a=t.timeParser(l["时间"]);2==a.length&&(e.tableView[a.weekday][a.start]={text1:l["选课序号"],text2:l["课程名称"],type:"double1",show:!0,style:""},e.tableView[a.weekday][a.start+1]={text1:l["教室"],text2:l["教师"],type:"double2",show:!0,style:""}),3==a.length&&(e.tableView[a.weekday][a.start]={text1:l["选课序号"],type:"triple1",show:!0,style:""},e.tableView[a.weekday][a.start+1]={text1:l["课程名称"],type:"triple2",show:!0,style:""},e.tableView[a.weekday][a.start+2]={text1:l["教室"],text2:l["教师"],type:"triple3",show:!0,style:""}),4==a.length&&(e.tableView[a.weekday][a.start]={text1:l["选课序号"],type:"fourfold1",show:!0,style:""},e.tableView[a.weekday][a.start+1]={text1:l["课程名称"],type:"fourfold2",show:!0,style:""},e.tableView[a.weekday][a.start+2]={text1:l["教室"],type:"fourfold3",show:!0,style:""},e.tableView[a.weekday][a.start+3]={text1:l["教师"],type:"fourfold4",show:!0,style:""})})}e.tableView=[[],[],[],[],[],[]],e.tableView.forEach(function(e){for(var t=0;13>t;t++)e.push({length:1})}),a(t.courseModel.data),e.$on("courseModelUpdate",function(e,t){a(t)}),e.hover=function(t,l){var a="background:rgba(255, 255, 255, 0.7)";return void 0==e.tableView[l][t].type?void(e.tableView[l][t].style=a):"double1"==e.tableView[l][t].type?(e.tableView[l][t].style=a,void(e.tableView[l][t+1].style=a)):"double2"==e.tableView[l][t].type?(e.tableView[l][t].style=a,void(e.tableView[l][t-1].style=a)):"triple1"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t+1].style=a,void(e.tableView[l][t+2].style=a)):"triple2"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t+1].style=a,void(e.tableView[l][t-1].style=a)):"triple3"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t-1].style=a,void(e.tableView[l][t-2].style=a)):"fourfold1"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t+1].style=a,e.tableView[l][t+2].style=a,void(e.tableView[l][t+3].style=a)):"fourfold2"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t+1].style=a,e.tableView[l][t+2].style=a,void(e.tableView[l][t-1].style=a)):"fourfold3"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t+1].style=a,e.tableView[l][t-1].style=a,void(e.tableView[l][t-2].style=a)):"fourfold4"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t-1].style=a,e.tableView[l][t-2].style=a,void(e.tableView[l][t-3].style=a)):void 0},e.out=function(t,l){var a="background:rgba(255, 255, 255, 0)";return void 0==e.tableView[l][t].type?void(e.tableView[l][t].style=a):"double1"==e.tableView[l][t].type?(e.tableView[l][t].style=a,void(e.tableView[l][t+1].style=a)):"double2"==e.tableView[l][t].type?(e.tableView[l][t].style=a,void(e.tableView[l][t-1].style=a)):"triple1"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t+1].style=a,void(e.tableView[l][t+2].style=a)):"triple2"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t+1].style=a,void(e.tableView[l][t-1].style=a)):"triple3"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t-1].style=a,void(e.tableView[l][t-2].style=a)):"fourfold1"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t+1].style=a,e.tableView[l][t+2].style=a,void(e.tableView[l][t+3].style=a)):"fourfold2"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t+1].style=a,e.tableView[l][t+2].style=a,void(e.tableView[l][t-1].style=a)):"fourfold3"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t+1].style=a,e.tableView[l][t-1].style=a,void(e.tableView[l][t-2].style=a)):"fourfold4"==e.tableView[l][t].type?(e.tableView[l][t].style=a,e.tableView[l][t-1].style=a,e.tableView[l][t-2].style=a,void(e.tableView[l][t-3].style=a)):void 0}}]);