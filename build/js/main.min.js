"use strict";var starkAPP=angular.module("starkAPP",["ngRoute","ngAnimate","routeStyles","baseService"]).config(["$compileProvider","$routeProvider","$locationProvider",function(e,t,a){t.when("/main/",{templateUrl:"./html/main.html",css:"./build/css/main.css"}).otherwise({redirectTo:"/main/"})}]);angular.module("baseService",[]).factory("BaseService",["$rootScope",function(e){function t(e){function t(e,t){return e.time&&-1==e.time.indexOf(t["时间"].trim())?!1:e.keywords&&-1==t["课程名称"].trim().indexOf(e.keywords.trim())?!1:e.courseID&&-1==t["选课序号"].trim().indexOf(e.courseID.trim())?!1:!0}var a=[];if(e.category.length>0)e.category.forEach(function(r){COURSE_DATA[r].forEach(function(r){t(e,r)&&a.push(r)})});else for(var r in COURSE_DATA)COURSE_DATA[r].forEach(function(r){t(e,r)&&a.push(r)});return a}function a(e){var t,a=e.trim();switch(a.split(" ")[0]){case"一":t=1;break;case"二":t=2;break;case"三":t=3;break;case"四":t=4;break;case"五":t=5;break;case"六":t=6}var r=parseInt(a.split(" ")[1].split("-")[1])-parseInt(a.split(" ")[1].split("-")[0])+1,o=parseInt(a.split(" ")[1].split("-")[0]);return{weekday:t-1,length:r,start:o-1}}String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};var r={data:[[],[],[],[],[],[]],init:function(){this.data.forEach(function(e){for(var t=0;13>t;t++)e.push(0)}),void 0!==localStorage.courseModelData&&(this.data=JSON.parse(localStorage.courseModelData))},update:function(t){var o=a(t["时间"]),i=o.weekday,s=o.start,n=o.length;if(0===this.data[i][s]&&0===this.data[i][s+1]&&0===this.data[i][s+n-1])for(var l=0;n>l;l++)r.data[i][s+l]=t;else{for(var c=[],l=0;n>l;l++)console.log(this.data[i][s+l]),-1==c.indexOf(this.data[i][s+l]["课程名称"])&&c.push(this.data[i][s+l]["课程名称"]);console.log(c);var u=c.length>1?c.join("、"):c[0];if(confirm("这门课与"+u+"冲突，是否替换？")){for(var l=0;13>l;l++)-1!=c.indexOf(this.data[i][l])&&(this.data[i][l]=0);for(var l=0;n>l;l++)r.data[i][s+l]=t}}var d=this.data;e.$broadcast("courseModelUpdate",d)}};r.init();var o={search:t,timeParser:a,courseModel:r};return o}]),angular.module("starkAPP").controller("resultController",["$scope","BaseService",function(e,t){}]),angular.module("starkAPP").controller("sidebarController",["$scope","BaseService","$timeout","$location",function(e,t,a,r){"/main/"==r.path()&&(e.mainIsActive=!0)}]),angular.module("starkAPP").controller("mainController",["$scope","BaseService","$timeout",function(e,t,a){e.tableView=[[],[],[],[],[],[]],e.$on("courseModelUpdate",function(a,r){var o=[];r.forEach(function(e){e.forEach(function(e){0!=e&&o.push(e)})}),o.forEach(function(a){var r=t.timeParser(a["时间"]);2==r.length&&(e.tableView[r.weekday][r.start]={text:a["选课序号"]+"\n"+a["课程名称"],type:"double1"},e.tableView[r.weekday][r.start+1]={text:a["教室"]+" "+a["教师"],type:"double2"}),3==r.length&&(e.tableView[r.weekday][r.start]={text:a["选课序号"],type:"triple1"},e.tableView[r.weekday][r.start+1]={text:a["课程名称"],type:"triple2"},e.tableView[r.weekday][r.start+2]={text:a["教室"]+" "+a["教师"],type:"triple3"}),4==r.length&&(e.tableView[r.weekday][r.start]={text:a["选课序号"],type:"fourfold1"},e.tableView[r.weekday][r.start+1]={text:a["课程名称"],type:"fourfold2"},e.tableView[r.weekday][r.start+2]={text:a["教室"],type:"fourfold3"},e.tableView[r.weekday][r.start+3]={text:a["教师"],type:"fourfold4"})})});var r={category:[],keywords:"",courseID:"",time:"一 6-7"},o=t.search(r);t.courseModel.update(o[5]),t.courseModel.update(o[2])}]);