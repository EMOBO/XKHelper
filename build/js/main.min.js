"use strict";var starkAPP=angular.module("starkAPP",["ngRoute","ngAnimate","routeStyles","baseService"]).config(["$compileProvider","$routeProvider","$locationProvider",function(e,t,o){t.when("/main/",{templateUrl:"./html/main.html"}).when("/all/",{templateUrl:"./html/all.html"}).when("/collection/",{templateUrl:"./html/collection.html"}).otherwise({redirectTo:"/main/"})}]);angular.module("baseService",[]).factory("BaseService",["$rootScope",function(e){function t(e){function t(e,t){return e.time&&-1==e.time.indexOf(t["时间"].trim())?!1:e.keywords&&-1==t["课程名称"].trim().indexOf(e.keywords.trim())?!1:e.courseID&&-1==t["选课序号"].trim().indexOf(e.courseID.trim())?!1:!0}if(!(e.time.length||e.keywords.length||e.courseID.length||e.category.length))return[];var o=[];if(e.category.length>0)e.category.forEach(function(a){COURSE_DATA[a].forEach(function(a){t(e,a)&&o.push(a)})});else for(var a in COURSE_DATA)COURSE_DATA[a].forEach(function(a){t(e,a)&&o.push(a)});return o}function o(e){var t,o=e.trim();switch(o.split(" ")[0]){case"一":t=1;break;case"二":t=2;break;case"三":t=3;break;case"四":t=4;break;case"五":t=5;break;case"六":t=6}var a=parseInt(o.split(" ")[1].split("-")[1])-parseInt(o.split(" ")[1].split("-")[0])+1,n=parseInt(o.split(" ")[1].split("-")[0]);return{weekday:t-1,length:a,start:n-1}}String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};var a={data:[[],[],[],[],[],[]],init:function(){this.data.forEach(function(e){for(var t=0;13>t;t++)e.push(0)}),void 0!==localStorage.courseModelData&&(this.data=JSON.parse(localStorage.courseModelData))},update:function(t){for(var a=t["时间"].split("{time}"),n=this,r=0;r<a.length;r++){var l=o(a[r]),i=l.weekday,c=l.start,s=l.length,d=r+1-1;n.updateOne(t,i,c,s,d)}var u=this.data;localStorage.courseModelData=JSON.stringify(u),e.$broadcast("courseModelUpdate",u)},updateOne:function(e,t,o,n,r){for(var l=!1,i=this,c=0;n>c;c++)0!=this.data[t][o+c]&&(l=!0);if(console.log(l),l){for(var s=[],d=[],c=0;n>c;c++)-1==s.indexOf(this.data[t][o+c]["课程名称"])&&0!=this.data[t][o+c]&&(s.push(this.data[t][o+c]["课程名称"]),d.push(this.data[t][o+c]));console.log(s);var u=s.length>1?s.join("》、《"):s[0];confirm("这门课与《"+u+"》冲突，是否替换？")&&(d.forEach(function(e){i.remove(e),console.log(e)}),this.update(e))}else for(var c=0;n>c;c++)a.data[t][o+c]=e,a.data[t][o+c].rank=r},remove:function(e){var t=e["时间"].split("{time}"),a=this;t.forEach(function(t){var n=o(t);a.removeOne(e,n)})},removeOne:function(t,o){for(var a=o.weekday,n=0;13>n;n++)this.data[a][n]["选课序号"]==t["选课序号"]&&(this.data[a][n]=0);var r=this.data;localStorage.courseModelData=JSON.stringify(r),e.$broadcast("courseModelUpdate",r)},check:function(e){var t=[];return this.data.forEach(function(e){e.forEach(function(e){0!=e&&-1===t.indexOf(e["选课序号"])&&t.push(e["选课序号"])})}),-1!=t.indexOf(e)}};a.init();var n={data:[],init:function(){void 0!==localStorage.collectionModelData&&(this.data=JSON.parse(localStorage.collectionModelData))},update:function(t){for(var o=0;o<this.data.length;o++)if(this.data[o]["选课序号"]==t["选课序号"])return;this.data.push(t);var a=this.data;localStorage.collectionModelData=JSON.stringify(a),e.$broadcast("collectionUpdate",a),console.log(this.data)},remove:function(t){for(var o=0;o<this.data.length;o++)if(this.data[o]["选课序号"]==t){this.data.splice(o,1);break}var a=this.data;localStorage.collectionModelData=JSON.stringify(a),e.$broadcast("collectionUpdate",a)},check:function(e){for(var t=0;t<this.data.length;t++)if(this.data[t]["选课序号"]==e)return!0;return!1}};n.init();var r={search:t,timeParser:o,courseModel:a,collectionModel:n};return r}]).filter("timeFilter",function(){var e=function(e){return void 0!=e?e.replace(/{time}/g,"，"):e};return e}),angular.module("starkAPP").controller("allController",["$scope","$rootScope","BaseService","$timeout","$location",function(e,t,o,a,n){var r=[];for(name in COURSE_DATA)r.push({name:name,courses:COURSE_DATA[name]});e.data=r;var l;e.handle={},e.showHandle=function(){var e=e||window.event;l=this.course,this.$parent.category.handle={},o.courseModel.check(this.course["选课序号"])?(this.$parent.category.handle.text1="已选入课表",this.$parent.category.handle.isInCourseTable=!0):(this.$parent.category.handle.text1="加入课表",this.$parent.category.handle.isInCourseTable=!1),o.collectionModel.check(this.course["选课序号"])?(this.$parent.category.handle.text2="已在收藏夹",this.$parent.category.handle.isInCollection=!0):(this.$parent.category.handle.text2="加入收藏夹",this.$parent.category.handle.isInCollection=!1);var t=e.clientY,a=e.clientX;this.$parent.category.handle.name=this.course["课程名称"],this.$parent.category.handle.teacher=this.course["教师"],this.$parent.category.handle.position="left:"+a+"px;top:"+t+"px;",this.$parent.category.handleIsShow=!0},e.closeHandle=function(){this.category.handleIsShow=!1},e.update=function(){o.courseModel.update(l)},e.addIntoBox=function(){o.collectionModel.update(l)}}]),angular.module("starkAPP").controller("collectionController",["$scope","$rootScope","BaseService","$timeout","$location",function(e,t,o,a,n){function r(){e.courses=o.collectionModel.data,e.courses.forEach(function(e){o.courseModel.check(e["选课序号"])?e.isInCourseTable=!0:e.isInCourseTable=!1,e.text=e.isInCourseTable?"已加入课表":"加入课表"}),console.log(e)}r(),e.$on("collectionUpdate",function(t){r(),console.log(e)}),e.$on("courseModelUpdate",function(e){r()}),e.addCourse=function(){o.courseModel.update(this.course)},e.remove=function(){o.collectionModel.remove(this.course["选课序号"])}}]),angular.module("starkAPP").controller("courseTableController",["$scope","BaseService","$timeout",function(e,t,o){function a(o){function a(t,o){if(2==o.length&&(e.tableView[o.weekday][o.start]={text1:t["选课序号"],text2:t["课程名称"],length:o.length,No:0,show:!0,style:"",locate:"start"},e.tableView[o.weekday][o.start+1]={text1:t["教室"],text2:t["教师"],length:o.length,No:1,show:!0,locate:"end"}),3==o.length&&(e.tableView[o.weekday][o.start]={text1:t["选课序号"],length:o.length,No:0,show:!0,style:"",locate:"start"},e.tableView[o.weekday][o.start+1]={text1:t["课程名称"],length:o.length,No:1,show:!0,style:"",locate:"body"},e.tableView[o.weekday][o.start+2]={text1:t["教室"],text2:t["教师"],length:o.length,No:2,show:!0,style:"",locate:"end"}),o.length>=4){for(var a=["选课序号","课程名称","教室","教师"],n=Math.floor((o.length-4)/2),r=0;r<o.length;r++)e.tableView[o.weekday][o.start+r]={length:o.length,No:r,show:!0,style:"",locate:"body"},0==r&&(e.tableView[o.weekday][o.start+r].locate="start"),r==o.length-1&&(e.tableView[o.weekday][o.start+r].locate="end");for(var r=0;4>r;r++){e.tableView[o.weekday][o.start+n+r].text1=t[a[r]]}}}e.tableView=[[],[],[],[],[],[]],e.tableView.forEach(function(e){for(var t=0;13>t;t++)e.push({length:1})});var n=[];o.forEach(function(e){e.forEach(function(e){0!=e&&n.push(e)})}),n.forEach(function(e){for(var o=e["时间"].split("{time}"),n=0;n<o.length;n++){var r=t.timeParser(o[n]);a(e,r)}})}a(t.courseModel.data),e.$on("courseModelUpdate",function(e,t){a(t)}),e.remove=function(e,o){var a=t.courseModel.data[e][o];t.courseModel.remove(a)},e.hover=function(t,o){for(var a="background:#ddd",n=e.tableView[o][t].No||0,r=e.tableView[o][t].length-n-1||0,l=0;n>=l;l++)e.tableView[o][t-l].style=a;for(var l=0;r>=l;l++)e.tableView[o][t+l].style=a},e.out=function(t,o){for(var a="",n=e.tableView[o][t].No||0,r=e.tableView[o][t].length-n-1||0,l=0;n>=l;l++)e.tableView[o][t-l].style=a;for(var l=0;r>=l;l++)e.tableView[o][t+l].style=a},e.showDetail=function(a,n){var r=r||window.event;if(0!==t.courseModel.data[a][n]){if(e.detail=t.courseModel.data[a][n],1==e.detailIsShow?(e.detailIsShow=!1,o(function(){e.detailIsShow=!0},0)):e.detailIsShow=!0,0===a||1===a||2===a){var l=r.layerY-100<0?0:r.layerY-100,i=15*(a+1)+10;e.detailPosition="top:"+l+"px;left:"+i+"%;"}if(3===a||4===a||5===a){var l=r.layerY-100<0?0:r.layerY-100,c=15*(6-a);e.detailPosition="top:"+l+"px;right:"+c+"%;"}}},e.closeDetail=function(){e.detailIsShow=!1},e.removeCourse=function(){t.courseModel.remove(e.detail)}}]),angular.module("starkAPP").controller("courseTotalController",["$scope","BaseService",function(e,t){function o(t){var o=[],a=[],n=0;t.forEach(function(e){e.forEach(function(e){0!=e&&-1===a.indexOf(e["选课序号"])&&(a.push(e["选课序号"]),o.push(e),n+=parseInt(e["学分"]))})}),e.list=o,e.totalCredit=n}o(t.courseModel.data),e.$on("courseModelUpdate",function(e,t){o(t)})}]),angular.module("starkAPP").controller("searchController",["$scope","BaseService","$timeout","$location",function(e,t,o,a){function n(o){t.courseModel.check(o)?(e.detail.isInCourseTable=!0,e.detail.text1="已加入课表"):(e.detail.isInCourseTable=!1,e.detail.text1="加入课表"),t.collectionModel.check(o)?(e.detail.isInCollection=!0,e.detail.text2="已在收藏夹"):(e.detail.isInCollection=!1,e.detail.text2="加入收藏夹")}e.$on("showSearch",function(){$(".search").css("z-index","100"),e.searchShow=!0,o(function(){$(".search-bar input").focus()},700)}),e.close=function(){var t=t||window.event;/bg/.test(t.target.className)&&(e.searchShow=!1,o(function(){$(".search").css("z-index","-9999")},700))},e.kwChange=function(){var o={category:[],keywords:e.keywords,courseID:"",time:""},a=t.search(o);e.result=a,a.length>0?e.resultShow=!0:e.resultShow=!1},e.mouseover=function(){e.detail=this.course,n(e.detail["选课序号"])},e.$on("courseModelUpdate",function(){n(e.detail["选课序号"])}),e.$on("collectionUpdate",function(){n(e.detail["选课序号"])}),e.courseUpdate=function(){t.courseModel.update(this.detail)},e.collectionUpdate=function(){t.collectionModel.update(this.detail)}}]),angular.module("starkAPP").controller("sidebarController",["$scope","$rootScope","BaseService","$timeout","$location",function(e,t,o,a,n){function r(){e.mainIsActive=e.allIsActive=e.collectionIsActive=!1,"/main/"==n.path()&&(e.mainIsActive=!0),"/all/"==n.path()&&(e.allIsActive=!0),"/collection/"==n.path()&&(e.collectionIsActive=!0)}r(),e.changeURL=function(e){n.url(e),r()},e.showSearch=function(){t.$broadcast("showSearch")}}]);